From c086661623e2378d22aeb38e2eee3a7feb6b93e8 Mon Sep 17 00:00:00 2001
From: Khem Raj <raj.khem@gmail.com>
Date: Tue, 24 Feb 2015 11:12:31 -0800
Subject: [PATCH] autotools: Use internal -lsyscfg -lsysevent -lulog libraries

Signed-off-by: Khem Raj <raj.khem@gmail.com>
---
 source/dhcpproxy/Makefile.am       | 11 ++++++-----
 source/firewall_log/Makefile.am    |  6 +++---
 source/services/lib/Makefile.am    |  5 ++---
 source/utapi/cmd/Makefile.am       |  6 +++---
 source/utapi/cmd/utcmd.c           |  2 +-
 source/utapi/unittest/utapi_test.c |  2 +-
 source/utctx/bin/Makefile.am       |  5 +++--
 source/utctx/lib/Makefile.am       |  8 +++++---
 source/utctx/lib/utctx_internal.h  |  2 +-
 9 files changed, 25 insertions(+), 22 deletions(-)

diff --git a/source/dhcpproxy/Makefile.am b/source/dhcpproxy/Makefile.am
index 997e1ed..2b0a488 100644
--- a/source/dhcpproxy/Makefile.am
+++ b/source/dhcpproxy/Makefile.am
@@ -5,10 +5,6 @@ AM_CFLAGS += -D_COSA_SIM_
 AM_LDFLAGS = -L/var/tmp/pc-rdkb/lib
 AM_LDFLAGS += -lpthread
 AM_LDFLAGS += -lz
-AM_LDFLAGS += -lsrvmgr
-AM_LDFLAGS += -lsyscfg
-AM_LDFLAGS += -lsysevent
-AM_LDFLAGS += -lulog
 
 
 AM_CPPFLAGS = -Wall -Werror
@@ -17,4 +13,9 @@ hardware_platform = i686-linux-gnu
 bin_PROGRAMS = dhcp_proxy
 dhcp_proxy_CPPFLAGS = -I$(top_srcdir)/source/igd/arch/intel_usg/boards/rdkb_arm/include -I$(top_srcdir)/source/firewall/arch/intel_usg/boards/rdkb_arm/include -I$(top_srcdir)/source/firewall/arch/intel_usg/boards/arm_shared/include -I$(top_srcdir)/source/include $(CPPFLAGS)
 dhcp_proxy_SOURCES = packet_util.c dhcp_proxy.c dhcp_util.c dhcp_msg.c
-dhcp_proxy_LDFLAGS = -L/var/tmp/pc-rdkb/lib -lpthread -lz -lsrvmgr -lsyscfg -lsysevent -lulog
+dhcp_proxy_LDFLAGS = -L/var/tmp/pc-rdkb/lib -lpthread -lz
+dhcp_proxy_LDADD =  $(top_builddir)/source/services/lib/libsrvmgr.la \
+                    $(top_builddir)/source/syscfg/lib/libsyscfg.la \
+                    $(top_builddir)/source/sysevent/lib/libsysevent.la \
+                    $(top_builddir)/source/ulog/libulog.la
+
diff --git a/source/firewall_log/Makefile.am b/source/firewall_log/Makefile.am
index cf4d6e6..45e994d 100644
--- a/source/firewall_log/Makefile.am
+++ b/source/firewall_log/Makefile.am
@@ -5,8 +5,6 @@ AM_CFLAGS += -D_COSA_SIM_
 AM_LDFLAGS = -L/var/tmp/pc-rdkb/lib
 AM_LDFLAGS += -lpthread
 AM_LDFLAGS += -lz
-AM_LDFLAGS += -lsyscfg
-AM_LDFLAGS += -lulog
 
 AM_CPPFLAGS = -Wall -Werror
 ACLOCAL_AMFLAGS = -I m4
@@ -14,4 +12,6 @@ hardware_platform = i686-linux-gnu
 bin_PROGRAMS = GenFWLog
 GenFWLog_CPPFLAGS = -I$(top_srcdir)/source/igd/arch/intel_usg/boards/rdkb_arm/include -I$(top_srcdir)/source/firewall/arch/intel_usg/boards/rdkb_arm/include -I$(top_srcdir)/source/firewall/arch/intel_usg/boards/arm_shared/include -I$(top_srcdir)/source/include $(CPPFLAGS)
 GenFWLog_SOURCES = GenFWLog.c
-GenFWLog_LDFLAGS =  -L/var/tmp/pc-rdkb/lib -lpthread -lz -lsyscfg -lulog
+GenFWLog_LDFLAGS =  -L/var/tmp/pc-rdkb/lib -lpthread -lz
+GenFWLog_LDADD = $(top_builddir)/source/syscfg/lib/libsyscfg.la \
+                 $(top_builddir)/source/ulog/libulog.la
diff --git a/source/services/lib/Makefile.am b/source/services/lib/Makefile.am
index 3b2a409..c09be7f 100644
--- a/source/services/lib/Makefile.am
+++ b/source/services/lib/Makefile.am
@@ -2,8 +2,6 @@ AM_CFLAGS = -D_ANSC_LINUX
 AM_CFLAGS += -D_ANSC_USER
 AM_CFLAGS += -D_ANSC_LITTLE_ENDIAN_
 AM_CFLAGS += -D_COSA_SIM_
-AM_LDFLAGS = -lsysevent
-AM_LDFLAGS += -lulog
 
 AM_CPPFLAGS = -Wall -Werror
 ACLOCAL_AMFLAGS = -I m4
@@ -12,4 +10,5 @@ hardware_platform = i686-linux-gnu
 lib_LTLIBRARIES = libsrvmgr.la
 libsrvmgr_la_CPPFLAGS = -I$(top_srcdir)/source/include $(CPPFLAGS)
 libsrvmgr_la_SOURCES = srvmgr.c
-libsrvmgr_la_LDFLAGS = -lsysevent -lulog
+libsrvmgr_la_LIBADD = $(top_builddir)/source/ulog/libulog.la
+libsrvmgr_la_LIBADD += $(top_builddir)/source/sysevent/lib/libsysevent.la
diff --git a/source/utapi/cmd/Makefile.am b/source/utapi/cmd/Makefile.am
index 047146b..7d0177e 100644
--- a/source/utapi/cmd/Makefile.am
+++ b/source/utapi/cmd/Makefile.am
@@ -3,13 +3,13 @@ AM_CFLAGS += -D_ANSC_USER
 AM_CFLAGS += -D_ANSC_LITTLE_ENDIAN_
 AM_CFLAGS += -D_COSA_SIM_
 AM_LDFLAGS = -L/var/tmp/pc-rdkb/lib
-AM_LDFLAGS += -lutapi -lutctx -lulog -lsyscfg -lsysevent
 
 AM_CPPFLAGS = -Wall -Werror
 ACLOCAL_AMFLAGS = -I m4
 hardware_platform = i686-linux-gnu
 
 bin_PROGRAMS = utcmd
-utcmd_CPPFLAGS = -I$(top_srcdir)/source/include $(CPPFLAGS)
+utcmd_CPPFLAGS = -I$(top_srcdir)/source/include -I$(top_srcdir)/source $(CPPFLAGS)
 utcmd_SOURCES = utcmd.c
-utcmd_LDFLAGS = -lutapi -lutctx -lulog -lsyscfg -lsysevent
+utcmd_LDADD = $(top_builddir)/source/utapi/lib/libutapi.la \
+              $(top_builddir)/source/utctx/lib/libutctx.la
diff --git a/source/utapi/cmd/utcmd.c b/source/utapi/cmd/utcmd.c
index 96d9f5f..96fd7ec 100644
--- a/source/utapi/cmd/utcmd.c
+++ b/source/utapi/cmd/utcmd.c
@@ -35,7 +35,7 @@
 #include <utctx/utctx.h>
 #include <utctx/utctx_api.h>
 #include <utapi/utapi.h>
-#include <utapi/utapi_wlan.h>
+#include <utapi/lib/utapi_wlan.h>
 
 typedef enum {
     CMD_FACTORY_RESET,
diff --git a/source/utapi/unittest/utapi_test.c b/source/utapi/unittest/utapi_test.c
index ddb51d1..edd2b59 100644
--- a/source/utapi/unittest/utapi_test.c
+++ b/source/utapi/unittest/utapi_test.c
@@ -46,7 +46,7 @@
 #include <utctx/utctx.h>
 #include <utctx/utctx_api.h>
 #include <utapi/utapi.h>
-#include <utapi/utapi_wlan.h>
+#include <lib/utapi_wlan.h>
 
 
 /*
diff --git a/source/utctx/bin/Makefile.am b/source/utctx/bin/Makefile.am
index 5e892c0..dddf8a7 100644
--- a/source/utctx/bin/Makefile.am
+++ b/source/utctx/bin/Makefile.am
@@ -3,7 +3,6 @@ AM_CFLAGS += -D_ANSC_USER
 AM_CFLAGS += -D_ANSC_LITTLE_ENDIAN_
 AM_CFLAGS += -D_COSA_SIM_
 AM_LDFLAGS = -L/var/tmp/pc-rdkb/lib
-AM_LDFLAGS += -lsyscfg -lsysevent -lutctx -lulog -lpthread
 
 AM_CPPFLAGS = -Wall -Werror
 ACLOCAL_AMFLAGS = -I m4
@@ -11,5 +10,7 @@ hardware_platform = i686-linux-gnu
 
 bin_PROGRAMS = utctx_cmd
 utctx_cmd_CPPFLAGS = -I$(top_srcdir)/source/include -I$(top_srcdir)/source/include/utctx $(CPPFLAGS)
+utctx_cmd_LDFLAGS = -lpthread
 utctx_cmd_SOURCES = utctx_cmd.c
-utctx_cmd_LDFLAGS =  -lsyscfg -lsysevent -lutctx -lulog -lpthread
+utctx_cmd_LDADD = $(top_builddir)/source/utctx/lib/libutctx.la
+
diff --git a/source/utctx/lib/Makefile.am b/source/utctx/lib/Makefile.am
index fcf1e1d..f03e17a 100644
--- a/source/utctx/lib/Makefile.am
+++ b/source/utctx/lib/Makefile.am
@@ -4,13 +4,15 @@ AM_CFLAGS += -D_ANSC_LITTLE_ENDIAN_
 AM_CFLAGS += -D_COSA_SIM_
 AM_CFLAGS += -DUTCTX_LOG
 AM_LDFLAGS = -L/var/tmp/pc-rdkb/lib
-AM_LDFLAGS += -lsyscfg -lsysevent -lulog 
 
 AM_CPPFLAGS = -Wall -Werror
 ACLOCAL_AMFLAGS = -I m4
 hardware_platform = i686-linux-gnu
 
 lib_LTLIBRARIES = libutctx.la
-libutctx_la_CPPFLAGS = -I$(top_srcdir)/source/include -I$(top_srcdir)/source/include/sysevent $(CPPFLAGS)
+libutctx_la_CPPFLAGS = -I$(top_srcdir)/source/include -I$(top_srcdir)/source $(CPPFLAGS)
 libutctx_la_SOURCES = utctx.c utctx_rwlock.c
-libutctx_la_LDFLAGS =  -L/var/tmp/pc-rdkb/lib -lsyscfg -lsysevent -lulog
+libutctx_la_LDFLAGS =  -L/var/tmp/pc-rdkb/lib
+libutctx_la_LIBADD = $(top_builddir)/source/ulog/libulog.la
+libutctx_la_LIBADD += $(top_builddir)/source/sysevent/lib/libsysevent.la
+libutctx_la_LIBADD += $(top_builddir)/source/syscfg/lib/libsyscfg.la
diff --git a/source/utctx/lib/utctx_internal.h b/source/utctx/lib/utctx_internal.h
index 542733a..f2bca34 100644
--- a/source/utctx/lib/utctx_internal.h
+++ b/source/utctx/lib/utctx_internal.h
@@ -51,7 +51,7 @@
 #include "unittest_syscfg.h"
 #else
 #include <sysevent/sysevent.h>
-#include <sysevent/libsysevent_internal.h>
+#include <sysevent/lib/libsysevent_internal.h>
 #include <syscfg/syscfg.h>
 #include <sys/reboot.h>
 #include <sys/select.h>
-- 
1.9.1

